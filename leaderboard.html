<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#1E2A38">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Points Leaderboard - Real Estate Rewards Program</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="leaderboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="leaderboard-page">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html">
                    <img src="assets/images/logo.png" alt="DeedDraw Logo">
                </a>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="how-it-works.html" class="nav-link">How It Works</a>
                <a href="prizes.html" class="nav-link">Prizes</a>
                <a href="register.html" class="nav-link">Register</a>
                <a href="winners.html" class="nav-link">Winners</a>
                <a href="contact.html" class="nav-link">Contact</a>
                
                <!-- Mobile-only nav links (hidden on desktop, shown instead of dropdown on mobile) -->
                <a href="leaderboard.html" class="nav-link mobile-only-nav-link active" style="display: none;">
                    <i class="fas fa-trophy"></i>
                    Points Leaderboard
                </a>
                <a href="rules.html" class="nav-link mobile-only-nav-link" style="display: none;">
                    <i class="fas fa-gavel"></i>
                    Rules & Regulations
                </a>
                <a href="faqs.html" class="nav-link mobile-only-nav-link" style="display: none;">
                    <i class="fas fa-question-circle"></i>
                    FAQs
                </a>
                
                <div class="dropdown">
                    <a href="#" class="nav-link dropdown-toggle">
                        <i class="fas fa-chevron-down"></i> More
                    </a>
                    <div class="dropdown-menu">
                        <a href="leaderboard.html" class="dropdown-item active">
                            <i class="fas fa-trophy"></i>
                            Points Leaderboard
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="rules.html" class="dropdown-item">
                            <i class="fas fa-gavel"></i>
                            Rules & Regulations
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="faqs.html" class="dropdown-item">
                            <i class="fas fa-question-circle"></i>
                            FAQs
                        </a>
                    </div>
                </div>
            </div>
            <div class="nav-auth">
                <a href="login.html" class="nav-link login-btn" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </a>
                <a href="dashboard.html" class="nav-link dashboard-btn" style="display: none;" id="dashboard-btn">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                
                <!-- User Profile Circle (Hidden by default) -->
                <div style="position: relative; display: none;" id="profile-circle">
                    <div class="user-avatar" onmouseenter="showMenu()" onmouseleave="hideMenuDelayed()" style="
                        width: 60px; 
                        height: 60px; 
                        background: rgba(51, 65, 85, 0.8); 
                        border-radius: 50%; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        cursor: pointer;
                        border: 3px solid #F59E0B;
                        transition: all 0.3s ease;
                    ">
                        <span style="color: #F59E0B; font-weight: 800; font-size: 1rem; font-family: 'Josefin Sans', sans-serif;" id="user-initials-leaderboard">JD</span>
                    </div>
                    
                    <!-- Dropdown Menu -->
                    <div id="user-dropdown-leaderboard" onmouseenter="showMenu()" onmouseleave="hideMenuDelayed()" style="
                        position: absolute;
                        top: 100%;
                        right: 0;
                        margin-top: 8px;
                        background: #1E2A38;
                        border-radius: 8px;
                        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                        min-width: 180px;
                        display: none;
                        z-index: 1001;
                    ">
                        <!-- User Info Header -->
                        <div style="padding: 16px 20px; border-radius: 8px 8px 0 0;">
                            <div style="font-weight: 600; color: #F59E0B; font-size: 1rem;" id="dropdown-user-name-leaderboard">John Doe</div>
                            <div style="font-size: 0.8rem; color: #b8c5d6; margin-top: 2px;" id="dropdown-user-category-leaderboard">Real Estate Agent</div>
                        </div>
                        
                        <!-- Divider -->
                        <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 0 auto; width: 85%;"></div>
                        
                        <!-- Dashboard Link -->
                        <a href="dashboard.html" class="dropdown-item" style="display: block; padding: 12px 20px; color: #fff; text-decoration: none; font-size: 0.9rem; transition: all 0.2s;">
                            <i class="fas fa-tachometer-alt" style="margin-right: 10px; width: 16px; color: #fff;"></i>
                            Dashboard
                        </a>
                        
                        <!-- Logout -->
                        <a href="#" onclick="logout(); return false;" class="dropdown-item logout-item" style="display: block; padding: 12px 20px; color: #fff; text-decoration: none; font-size: 0.9rem; transition: all 0.2s;">
                            <i class="fas fa-sign-out-alt" style="margin-right: 10px; width: 16px; color: #fff;"></i>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Hero Section -->
        <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title"><i class="fas fa-trophy"></i> Points Leaderboard</h1>
            <p class="hero-subtitle">See who's leading the race to the next drawing</p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="leaderboard-main">
        <div class="container">
            <!-- Search Section -->
            <section class="search-section">
                <div class="search-box">
                    <h3 class="search-title">Search Participants</h3>
                    <div class="search-container">
                        <input type="text" id="participant-search" class="search-input" placeholder="Search participants..." autocomplete="off">
                        <i class="fas fa-search search-icon"></i>
                        <div id="search-results" class="search-results"></div>
                    </div>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="progress-section">
                <h2 class="section-header">Drawing Progress</h2>
                <div class="drawing-progress">
                    <div class="progress-header">
                        <h3>Progress to Next Drawing</h3>
                        <span class="progress-count" id="progress-count">0 / 400 Points</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" data-progress="0">
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <p class="progress-info">
                        <i class="fas fa-info-circle"></i>
                        Drawing triggers automatically when 400 points are reached
                    </p>
                </div>
            </section>

            <!-- Leaderboard Table -->
            <section class="leaderboard-section">
                <div class="leaderboard-header">
                    <h2><i class="fas fa-chart-line"></i> Current Standings</h2>
                    <div class="filters">
                        <select id="category-filter" class="filter-select">
                            <option value="all">All Categories</option>
                            <option value="agent-broker">Agents & Brokers</option>
                            <option value="developer">Developers</option>
                            <option value="sales-marketing">Sales & Marketing</option>
                            <option value="mortgage-broker">Mortgage Brokers</option>
                        </select>
                        <button id="refresh-btn" class="refresh-btn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="leaderboard-table-container">
                    <table class="leaderboard-table" id="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Participant</th>
                                <th>Location</th>
                                <th>Points</th>
                                <th>Registration Date</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-tbody">
                            <!-- Data will be populated by JavaScript from API -->
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 2rem; color: #94A3B8;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                                    <br>Loading leaderboard...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Stats Section -->
                <div class="leaderboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-number" id="total-participants" data-target="0">0</h3>
                            <p>Total Participants</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-number" id="prize-pool" data-target="0" data-suffix="K" data-prefix="$">$0K</h3>
                            <p>Prize Pool</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-number" id="total-points" data-target="0">0</h3>
                            <p>Total Points Earned</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-number" data-target="15" data-suffix=" Prizes">15 Prizes</h3>
                            <p>Available to Win</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Call to Action -->
            <section class="leaderboard-cta">
                <div class="cta-content">
                    <h2>Join the Competition!</h2>
                    <p>Start earning points from your real estate transactions and climb the leaderboard.</p>
                    <div class="cta-buttons">
                        <a href="#" onclick="scrollToRegistration(event)" class="btn-primary">
                            <i class="fas fa-user-plus"></i>
                            Register Now
                        </a>
                        <a href="how-it-works.html" class="btn-secondary">
                            <i class="fas fa-info-circle"></i>
                            Learn How
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-main">
            <div class="container">
                <div class="footer-content">
                    <!-- Company Info -->
                    <div class="footer-section">
                        <div class="footer-logo">
                            <img src="assets/images/logo.png" alt="DeedDraw Logo">
                            <p>Turning real estate success into life-changing opportunities through transparent, fair rewards.</p>
                        </div>
                        <div class="footer-social">
                            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                            <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                            <a href="https://www.instagram.com/deeddraw" target="_blank" rel="noopener noreferrer" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="how-it-works.html">How It Works</a></li>
                            <li><a href="index.html#calculator">Point Calculator</a></li>
                            <li><a href="leaderboard.html">Participants</a></li>
                            <li><a href="register.html" id="footer-register-link">Register Now</a></li>
                        </ul>
                    </div>

                    <!-- Support -->
                    <div class="footer-section">
                        <h4>Support</h4>
                        <ul>
                            <li><a href="faqs.html">FAQs</a></li>
                            <li><a href="contact.html">Contact Us</a></li>
                            <li><a href="rules.html">Rules & Regulations</a></li>
                            <li><a href="leaderboard.html">View Leaderboard</a></li>
                        </ul>
                    </div>

                    <!-- Legal -->
                    <div class="footer-section">
                        <h4>Legal</h4>
                        <ul>
                            <li><a href="rules.html#terms-of-service">Terms of Service</a></li>
                            <li><a href="rules.html#privacy-policy">Privacy Policy</a></li>
                            <li><a href="rules.html#drawing-rules">Drawing Rules</a></li>
                            <li><a href="rules.html#disclaimer">Disclaimer</a></li>
                        </ul>
                    </div>

                    <!-- Contact Info -->
                    <div class="footer-section">
                        <h4>Get In Touch</h4>
                        <div class="contact-info">
                            <div class="contact-item">
                                <i class="fas fa-envelope"></i>
                                <span>support@deeddraw.com</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <span>1 - (604) 670-8080</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>828 Harbourside Dr<br>North Vancouver, BC<br>Canada</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Bottom -->
        <div class="footer-bottom">
            <div class="container">
                <div class="footer-bottom-content">
                    <div class="footer-copyright">
                        <p>&copy; 2025 DeedDraw. All rights reserved. | <span class="trust-text">SSL Secured</span> | <span class="trust-text">Bank-Grade Security</span> | <span class="trust-text">Verified Platform</span></p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript for navbar functionality -->
    <script>
        // Profile dropdown functions - Make them global
        let hideTimeout;

        window.showMenu = function() {
            clearTimeout(hideTimeout);
            const dropdown = document.getElementById('user-dropdown-leaderboard');
            if (dropdown) {
                dropdown.style.display = 'block';
            }
        };

        window.hideMenuDelayed = function() {
            hideTimeout = setTimeout(function() {
                const dropdown = document.getElementById('user-dropdown-leaderboard');
                if (dropdown) {
                    dropdown.style.display = 'none';
                }
            }, 200); // Small delay to prevent flickering when moving between avatar and dropdown
        };

        window.logout = function() {
            // Clear user session
            localStorage.removeItem('userSession');
            sessionStorage.removeItem('userSession');
            
            // Show logout message
            alert('You have been logged out successfully.');
            
            // Redirect to home page
            window.location.href = 'index.html';
        };

        // Check user session and update navbar
        function checkUserSession() {
            const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
            const userData = localStorage.getItem('userData') || sessionStorage.getItem('userData');
            
            if (sessionData && userData) {
                try {
                    const session = JSON.parse(sessionData);
                    const user = JSON.parse(userData);
                    
                    if (user && session.userId && session.email) {
                        // User is logged in - show profile circle, hide login button
                        const loginBtn = document.getElementById('login-btn');
                        const profileCircle = document.getElementById('profile-circle');
                        
                        loginBtn.style.display = 'none';
                        loginBtn.style.visibility = 'hidden';
                        loginBtn.style.opacity = '0';
                        loginBtn.style.position = 'absolute';
                        loginBtn.style.pointerEvents = 'none';
                        
                        profileCircle.style.display = 'block';
                        profileCircle.style.visibility = 'visible';
                        profileCircle.style.opacity = '1';
                        profileCircle.style.position = 'relative';
                        profileCircle.style.pointerEvents = 'auto';
                        
                        // Update user info in profile circle
                        const initials = (user.firstName[0] + user.lastName[0]).toUpperCase();
                        document.getElementById('user-initials-leaderboard').textContent = initials;
                        document.getElementById('dropdown-user-name-leaderboard').textContent = user.firstName + ' ' + user.lastName;
                        
                        // Map category codes to readable names
                        const categoryMap = {
                            'agent-broker': 'Real Estate Agent',
                            'developer': 'Developer', 
                            'sales-marketing': 'Sales & Marketing',
                            'mortgage-broker': 'Mortgage Broker'
                        };
                        
                        const categoryDisplay = categoryMap[user.category] || user.category;
                        document.getElementById('dropdown-user-category-leaderboard').textContent = categoryDisplay;
                        
                        return;
                    } else {
                        localStorage.removeItem('userSession');
                        sessionStorage.removeItem('userSession');
                        localStorage.removeItem('userData');
                        sessionStorage.removeItem('userData');
                    }
                } catch (error) {
                    console.error('Error parsing session data:', error);
                    localStorage.removeItem('userSession');
                    sessionStorage.removeItem('userSession');
                    localStorage.removeItem('userData');
                    sessionStorage.removeItem('userData');
                }
            }
            
            // User is not logged in - show login button, hide profile circle
            const loginBtn = document.getElementById('login-btn');
            const profileCircle = document.getElementById('profile-circle');
            
            loginBtn.style.display = 'flex';
            loginBtn.style.visibility = 'visible';
            loginBtn.style.opacity = '1';
            loginBtn.style.position = 'relative';
            loginBtn.style.pointerEvents = 'auto';
            
            profileCircle.style.display = 'none';
            profileCircle.style.visibility = 'hidden';
            profileCircle.style.opacity = '0';
            profileCircle.style.position = 'absolute';
            profileCircle.style.pointerEvents = 'none';
        }

        // Check session when page loads
        document.addEventListener('DOMContentLoaded', function() {
            checkUserSession();
        });

        // Add hover effects to dropdown items
        document.addEventListener('DOMContentLoaded', function() {
            const dropdownItems = document.querySelectorAll('.dropdown-item');
            dropdownItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#2B394A';
                    this.style.color = '#F59E0B';
                    
                    // Also change icon color to gold
                    const icon = this.querySelector('i');
                    if (icon) {
                        icon.style.color = '#F59E0B';
                    }
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#fff';
                    
                    // Reset icon color to white
                    const icon = this.querySelector('i');
                    if (icon) {
                        icon.style.color = '#fff';
                    }
                });
            });
        });
    </script>

    <!-- Leaderboard Functionality -->
    <script>
        const API_URL = 'https://www.deeddraw.com/api';
        // Leaderboard data - will be fetched from API
        let leaderboardData = [];

        // Function to handle registration button click
        function scrollToRegistration(event) {
            event.preventDefault();
            
            // Check if user is logged in
            const token = localStorage.getItem('token');
            
            if (token) {
                // User is logged in, redirect to dashboard registration tab
                window.location.href = 'dashboard.html#register';
            } else {
                // User is not logged in, redirect to login page
                window.location.href = 'login.html';
            }
        }

        // Function to fetch leaderboard data from API
        async function fetchLeaderboardData() {
            try {
                const response = await fetch(`${API_URL}/public/leaderboard`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Transform API data to match our display format
                    leaderboardData = result.data.map(participant => {
                        // Get initials for avatar
                        const nameParts = participant.name.split(' ');
                        const initials = nameParts.map(part => part.charAt(0).toUpperCase()).join('');
                        
                        // Map category to display name for subtitle
                        const categoryMap = {
                            'agent-broker': 'Real Estate Agent/Broker',
                            'developer': 'Developer',
                            'sales-marketing': 'Sales & Marketing',
                            'mortgage-broker': 'Mortgage Broker'
                        };
                        const categoryDisplay = categoryMap[participant.category] || participant.category;
                        
                        return {
                            name: participant.name,
                            subtitle: categoryDisplay,
                            category: participant.category,
                            categoryDisplay: categoryDisplay,
                            location: participant.location || 'N/A',
                            points: participant.points,
                            registrationDate: participant.registrationDate || new Date().toISOString(),
                            initials: initials
                        };
                    });
                    
                    filterLeaderboard();
                } else {
                    console.error('Failed to fetch leaderboard data');
                }
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
            }
        }

        // Function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Function to get rank badge HTML
        function getRankBadge(rank) {
            let badgeClass = '';
            let icon = '';
            
            if (rank === 1) {
                badgeClass = 'gold';
                icon = '<i class="fas fa-crown"></i>';
            } else if (rank === 2) {
                badgeClass = 'silver';
                icon = '<i class="fas fa-medal"></i>';
            } else if (rank === 3) {
                badgeClass = 'bronze';
                icon = '<i class="fas fa-award"></i>';
            }
            
            return `<div class="rank-badge ${badgeClass}">${icon}#${rank}</div>`;
        }

        // Function to render leaderboard
        function renderLeaderboard(data) {
            const tbody = document.getElementById('leaderboard-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: #94A3B8;">No participants found</td></tr>';
                return;
            }
            
            data.forEach((participant, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');
                if (rank <= 3) {
                    row.classList.add(`rank-${rank}`);
                }
                
                row.innerHTML = `
                    <td class="rank-cell">
                        ${getRankBadge(rank)}
                    </td>
                    <td class="participant-cell">
                        <div class="participant-info">
                            <div class="participant-avatar">${participant.initials}</div>
                            <div>
                                <div class="participant-name">${participant.name}</div>
                                <div class="participant-subtitle">${participant.subtitle}</div>
                            </div>
                        </div>
                    </td>
                    <td>${participant.location}</td>
                    <td class="points-cell">
                        <span class="points-badge">${participant.points} pts</span>
                    </td>
                    <td>${formatDate(participant.registrationDate)}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Function to filter leaderboard
        function filterLeaderboard() {
            const categoryFilter = document.getElementById('category-filter');
            const searchInput = document.getElementById('participant-search');
            if (!categoryFilter) return;
            
            const selectedCategory = categoryFilter.value;
            const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
            
            let filteredData = leaderboardData;
            
            // Filter by category
            if (selectedCategory !== 'all') {
                filteredData = filteredData.filter(participant => 
                    participant.category === selectedCategory
                );
            }
            
            // Filter by search term
            if (searchTerm) {
                filteredData = filteredData.filter(participant => 
                    participant.name.toLowerCase().includes(searchTerm)
                );
            }
            
            // Sort by points (descending)
            filteredData.sort((a, b) => b.points - a.points);
            
            renderLeaderboard(filteredData);
        }

        // Function to update progress bar with real data
        async function updateProgress() {
            try {
                const response = await fetch(`${API_URL}/public/stats`);
                const result = await response.json();
                const data = result.data || result; // Handle both wrapped and unwrapped responses
                
                const totalPoints = data.totalPoints || 0;
                const targetPoints = data.targetPoints || 400;
                const percentage = data.progress || 0;
                
                const progressFill = document.getElementById('progress-fill');
                const progressCount = document.getElementById('progress-count');
                
                if (progressFill) {
                    // Set the data attribute for scroll animation
                    progressFill.dataset.progress = percentage;
                    
                    // Animate from 0 to actual percentage
                    let currentProgress = 0;
                    const increment = percentage / 50; // 50 steps
                    const interval = setInterval(() => {
                        currentProgress += increment;
                        if (currentProgress >= percentage) {
                            currentProgress = percentage;
                            clearInterval(interval);
                        }
                        progressFill.style.width = `${currentProgress}%`;
                        const progressText = progressFill.querySelector('.progress-text');
                        if (progressText) {
                            progressText.textContent = `${currentProgress.toFixed(1)}%`;
                        }
                    }, 20);
                }
                
                if (progressCount) {
                    progressCount.textContent = `${totalPoints} / ${targetPoints} Points`;
                }
            } catch (error) {
                console.error('Error fetching progress data:', error);
                // Fallback to hardcoded data if API fails
                const totalPoints = leaderboardData.reduce((sum, participant) => sum + participant.points, 0);
                const targetPoints = 400;
                const percentage = Math.min((totalPoints / targetPoints) * 100, 100);
                
                const progressFill = document.getElementById('progress-fill');
                const progressCount = document.getElementById('progress-count');
                
                if (progressFill) {
                    // Set the data attribute for scroll animation
                    progressFill.dataset.progress = percentage;
                    
                    progressFill.style.width = `${percentage}%`;
                    const progressText = progressFill.querySelector('.progress-text');
                    if (progressText) {
                        progressText.textContent = `${percentage.toFixed(1)}%`;
                    }
                }
                
                if (progressCount) {
                    progressCount.textContent = `${totalPoints} / ${targetPoints} Points`;
                }
            }
        }

        // Function to update leaderboard stats with real data
        async function updateLeaderboardStats() {
            try {
                const response = await fetch(`${API_URL}/public/stats`);
                const result = await response.json();
                const data = result.data || result;
                
                const totalParticipants = data.participants || 0;
                const prizePool = (data.prizePool || 500000) / 1000; // Convert to K (500 = $500K)
                const totalPoints = data.totalPoints || 0;
                
                // Animate Total Participants
                const participantsEl = document.getElementById('total-participants');
                if (participantsEl) {
                    animateNumber(participantsEl, 0, totalParticipants, 1000);
                }
                
                // Animate Prize Pool
                const prizePoolEl = document.getElementById('prize-pool');
                if (prizePoolEl) {
                    animateNumber(prizePoolEl, 0, prizePool, 1000, '$', 'K');
                }
                
                // Animate Total Points
                const totalPointsEl = document.getElementById('total-points');
                if (totalPointsEl) {
                    animateNumber(totalPointsEl, 0, totalPoints, 1000);
                }
            } catch (error) {
                console.error('Error fetching leaderboard stats:', error);
            }
        }
        
        // Function to animate numbers
        function animateNumber(element, start, end, duration, prefix = '', suffix = '') {
            const range = end - start;
            const increment = range / (duration / 16); // 60fps
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                
                // Format the number
                let displayValue = Math.round(current);
                if (suffix === 'K') {
                    displayValue = current.toFixed(0);
                }
                
                element.textContent = `${prefix}${displayValue}${suffix}`;
                element.setAttribute('data-target', end);
            }, 16);
        }

        // Function to refresh data (simulate API call)
        function refreshData() {
            const refreshBtn = document.getElementById('refresh-btn');
            if (refreshBtn) {
                const icon = refreshBtn.querySelector('i');
                if (icon) {
                    icon.classList.add('fa-spin');
                }
                
                // Simulate API delay
                setTimeout(() => {
                    // In real app, this would fetch fresh data from server
                    console.log('Data refreshed!');
                    
                    if (icon) {
                        icon.classList.remove('fa-spin');
                    }
                    
                    // Show notification
                    showNotification('Leaderboard updated successfully!');
                }, 1000);
            }
        }

        // Function to show notifications
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
                color: #1a202c;
                padding: 15px 20px;
                border-radius: 8px;
                font-family: 'Josefin Sans', sans-serif;
                font-weight: 600;
                box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Initialize leaderboard when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch real data and render
            fetchLeaderboardData();
            updateProgress();
            updateLeaderboardStats();
            
            // Event listeners
            const categoryFilter = document.getElementById('category-filter');
            if (categoryFilter) {
                categoryFilter.addEventListener('change', filterLeaderboard);
            }
            
            // Live search functionality
            let searchTimeout;
            const searchInput = document.getElementById('participant-search');
            const searchResultsContainer = document.getElementById('search-results');
            
            if (searchInput && searchResultsContainer) {
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.trim();
                    
                    // Clear previous timeout
                    clearTimeout(searchTimeout);
                    
                    // If query is less than 2 characters, clear results
                    if (query.length < 2) {
                        searchResultsContainer.innerHTML = '';
                        searchResultsContainer.style.display = 'none';
                        return;
                    }
                    
                    // Debounce the search - wait 300ms after user stops typing
                    searchTimeout = setTimeout(async () => {
                        try {
                            const response = await fetch(`${API_URL}/public/search-participants?query=${encodeURIComponent(query)}`);
                            const result = await response.json();
                            
                            if (result.success) {
                                displaySearchResults(result.data);
                            } else {
                                searchResultsContainer.innerHTML = '<p style="padding: 1rem; text-align: center; color: #64748b;">Error loading results</p>';
                                searchResultsContainer.style.display = 'block';
                            }
                        } catch (error) {
                            console.error('Error searching participants:', error);
                            searchResultsContainer.innerHTML = '<p style="padding: 1rem; text-align: center; color: #64748b;">Error loading results</p>';
                            searchResultsContainer.style.display = 'block';
                        }
                    }, 300);
                });
                
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Escape') {
                        this.value = '';
                        searchResultsContainer.innerHTML = '';
                        searchResultsContainer.style.display = 'none';
                    }
                });
                
                // Close search results when clicking outside
                document.addEventListener('click', function(e) {
                    if (!searchInput.contains(e.target) && !searchResultsContainer.contains(e.target)) {
                        searchResultsContainer.style.display = 'none';
                    }
                });
            }
            
            const refreshBtn = document.getElementById('refresh-btn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', refreshData);
            }
        });
        
        // Function to display search results
        function displaySearchResults(participants) {
            const searchResultsContainer = document.getElementById('search-results');
            if (!searchResultsContainer) return;
            
            if (participants.length === 0) {
                searchResultsContainer.innerHTML = '<p style="padding: 1rem; text-align: center; color: #64748b;">No participants found</p>';
                searchResultsContainer.style.display = 'block';
                return;
            }
            
            const resultsHTML = participants.map(participant => {
                // Get initials for avatar
                const nameParts = participant.name.split(' ');
                const initials = nameParts.map(part => part.charAt(0).toUpperCase()).join('');
                
                // Format category display
                const categoryMap = {
                    'agent-broker': 'Real Estate Agent/Broker',
                    'developer': 'Developer',
                    'sales-marketing': 'Sales & Marketing',
                    'mortgage-broker': 'Mortgage Broker'
                };
                const categoryDisplay = categoryMap[participant.category] || participant.category;
                
                return `
                    <div class="search-result-item" style="display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid rgba(226, 232, 240, 0.3); transition: background 0.3s ease;">
                        <div class="participant-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #F59E0B, #D97706); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; margin-right: 1rem; flex-shrink: 0;">
                            ${initials}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; color: #ffffff; margin-bottom: 0.25rem;">${participant.name}</div>
                            <div style="font-size: 0.85rem; color: #cbd5e1;">${categoryDisplay}</div>
                        </div>
                        <div style="text-align: right; flex-shrink: 0;">
                            <div style="font-weight: 700; color: #F59E0B; font-size: 1.1rem;">${participant.points}</div>
                            <div style="font-size: 0.75rem; color: #64748b; text-transform: uppercase;">Points</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            searchResultsContainer.innerHTML = resultsHTML;
            searchResultsContainer.style.display = 'block';
        }
    </script>

    <!-- Hamburger Menu Functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            
            if (hamburger && navMenu) {
                hamburger.addEventListener('click', function() {
                    hamburger.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });

                // Close menu when clicking on a nav link
                const navLinks = document.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        hamburger.classList.remove('active');
                        navMenu.classList.remove('active');
                    });
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    const isClickInsideNav = navMenu.contains(event.target);
                    const isClickOnHamburger = hamburger.contains(event.target);
                    
                    if (!isClickInsideNav && !isClickOnHamburger) {
                        hamburger.classList.remove('active');
                        navMenu.classList.remove('active');
                    }
                });
            }
        });
    </script>
    
    <!-- Coming Soon Function for Incomplete Pages -->
    <script>
        function showComingSoon(pageName) {
            alert(`ðŸš§ ${pageName} page is coming soon!\n\nThis section is currently under development. Please check back later for updates.`);
        }

        // Count-up Animation for Stats
        function animateCounter(element, target, duration = 2000) {
            const start = 0;
            const increment = target / (duration / 16);
            let current = start;
            const prefix = element.dataset.prefix || '';
            const suffix = element.dataset.suffix || '';
            
            // Determine if this should be integer-only (for prizes, participants, points)
            const isIntegerOnly = suffix.includes('Prizes') || suffix === '' || !suffix.includes('M');
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                
                let displayValue;
                if (isIntegerOnly) {
                    // For integers (prizes, participants, points)
                    displayValue = Math.floor(current);
                } else {
                    // For decimals (transaction values like $123.5M)
                    displayValue = Math.floor(current * 10) / 10;
                }
                
                element.textContent = prefix + displayValue + suffix;
            }, 16);
        }

        // Intersection Observer for Stats Animation
        const statsObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const statNumbers = entry.target.querySelectorAll('.stat-number');
                    statNumbers.forEach((stat, index) => {
                        if (!stat.dataset.animated) {
                            const target = parseFloat(stat.dataset.target);
                            const delay = index * 200; // 200ms delay between each stat
                            const duration = 2000 + (index * 100); // Each animation slightly longer than previous
                            
                            setTimeout(() => {
                                animateCounter(stat, target, duration);
                            }, delay);
                            
                            stat.dataset.animated = 'true';
                        }
                    });
                }
            });
        }, { threshold: 0.5 });

        // Progress Bar Animation (copied from working prizes page)
        let progressAnimationTriggered = false;
        
        function animatePercentage(start, end, element) {
            const duration = 2500; // Match CSS transition duration
            const startTime = performance.now();
            
            function updatePercentage(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const current = start + (end - start) * progress;
                element.textContent = Math.round(current * 10) / 10 + '%';
                
                if (progress < 1) {
                    requestAnimationFrame(updatePercentage);
                }
            }
            
            requestAnimationFrame(updatePercentage);
        }
        
        function checkProgressScroll() {
            if (progressAnimationTriggered) return;
            
            const section = document.querySelector('.progress-section');
            if (!section) return;
            
            const rect = section.getBoundingClientRect();
            const windowHeight = window.innerHeight;
            
            // Trigger when section is 70% visible
            if (rect.top < windowHeight * 0.7 && rect.bottom > 0) {
                progressAnimationTriggered = true;
                
                const progressFill = document.querySelector('.progress-fill');
                const progressText = document.querySelector('.progress-text');
                
                if (progressFill && progressText) {
                    const targetProgress = parseFloat(progressFill.dataset.progress);
                    
                    // Start progress bar animation
                    progressFill.style.width = targetProgress + '%';
                    
                    // Animate percentage counter
                    animatePercentage(0, targetProgress, progressText);
                }
                
                // Remove scroll listener
                window.removeEventListener('scroll', checkProgressScroll);
            }
        }

        // Initialize animations
        document.addEventListener('DOMContentLoaded', () => {
            const statsSection = document.querySelector('.leaderboard-stats');
            
            if (statsSection) {
                statsObserver.observe(statsSection);
            }
            
            // Disable scroll-based progress animation since API handles it
            // window.addEventListener('scroll', checkProgressScroll);
        });
    </script>
    
    <!-- Footer Register Link Handler -->
    <script>
        function handleFooterRegisterClick(e) {
            const token = localStorage.getItem('token');
            if (token) {
                e.preventDefault();
                window.location.href = 'dashboard.html#register';
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            const footerRegisterLink = document.getElementById('footer-register-link');
            if (footerRegisterLink) {
                footerRegisterLink.addEventListener('click', handleFooterRegisterClick);
            }
        });
    </script>

    </div>
    <!-- End Main Container -->

    <script src="auth.js"></script>
</body>
</html>
